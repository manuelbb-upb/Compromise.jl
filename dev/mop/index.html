<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>AbstractMOP Interface · Compromise.jl</title><meta name="title" content="AbstractMOP Interface · Compromise.jl"/><meta property="og:title" content="AbstractMOP Interface · Compromise.jl"/><meta property="twitter:title" content="AbstractMOP Interface · Compromise.jl"/><meta name="description" content="Documentation for Compromise.jl."/><meta property="og:description" content="Documentation for Compromise.jl."/><meta property="twitter:description" content="Documentation for Compromise.jl."/><meta property="og:url" content="https://manuelbb-upb.github.io/Compromise.jl/mop/"/><meta property="twitter:url" content="https://manuelbb-upb.github.io/Compromise.jl/mop/"/><link rel="canonical" href="https://manuelbb-upb.github.io/Compromise.jl/mop/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Compromise.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../README/">README</a></li><li><a class="tocitem" href="../stopping/">Stopping Criteria</a></li><li><a class="tocitem" href="../rbf_database_callback/">RBF Data Sharing</a></li></ul></li><li><a class="tocitem" href="../dev_notes/">(Dev) Notes</a></li><li><span class="tocitem">Interfaces</span><ul><li><a class="tocitem" href="../CompromiseEvaluators/">Module <code>CompromiseEvaluators</code></a></li><li class="is-active"><a class="tocitem" href>AbstractMOP Interface</a><ul class="internal"><li><a class="tocitem" href="#Meta-Data"><span>Meta-Data</span></a></li><li><a class="tocitem" href="#Linear-Constraints"><span>Linear Constraints</span></a></li><li><a class="tocitem" href="#Evaluation"><span>Evaluation</span></a></li><li><a class="tocitem" href="#Pre-Allocation"><span>Pre-Allocation</span></a></li></ul></li><li><a class="tocitem" href="../models/">AbstractMOPSurrogate Interface</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Interfaces</a></li><li class="is-active"><a href>AbstractMOP Interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>AbstractMOP Interface</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/manuelbb-upb/Compromise.jl/blob/main/docs/src/mop.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="AbstractMOP-Interface"><a class="docs-heading-anchor" href="#AbstractMOP-Interface">AbstractMOP Interface</a><a id="AbstractMOP-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#AbstractMOP-Interface" title="Permalink"></a></h1><p>An object subtyping <code>AbstractMOP</code> is a glorified wrapper around vector-vector functions. The methods below were originally meant to be used to implement our algorithm similar to how it has been stated in the article, rather “mathematically“. That is, we do not care for how the problem has been modelled and set up. We only need function handles and some meta-data concerning dimensions and data types.</p><p>Formally, our problem reads</p><p class="math-container">\[\begin{aligned}
&amp;\min_{x = [x₁, …, x_N]}
    \begin{bmatrix}
        f₁(x)   \\
        ⋮       \\
        f_K(x)
    \end{bmatrix}
        &amp;\text{subject to}\\
    &amp; g(x) = [g₁(x), …, g_P(x)] ≤ 0, \\
    &amp; h(x) = [h₁(x), …, h_M(x)] = 0, \\
    &amp; lb ≤ x ≤ ub,  A ⋅ x ≤ b, E ⋅ x = c.
\end{aligned}\]</p><p>In the code, we often follow this notation:</p><ul><li><code>f</code> indicates an objective function.</li><li><code>g</code> a nonlinear inequality constraint.</li><li><code>h</code> a nonlinear equality constriant.</li><li><code>A</code> is the matrix of linear inequality constraints, <code>b</code> the right hand side vector.</li><li><code>E</code> is the matrix of linear equality constraints, <code>c</code> the right hand side vector.</li><li><code>lb</code> and <code>ub</code> define box constraints.</li></ul><p>At the beginning of an optimization routine, initialization based on the initial site can be performed:</p><pre><code class="language-julia hljs">initialize(mop::AbstractMOP, ξ0::RVec)=mop</code></pre><h2 id="Meta-Data"><a class="docs-heading-anchor" href="#Meta-Data">Meta-Data</a><a id="Meta-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Meta-Data" title="Permalink"></a></h2><p>The optional function <code>precision</code> returns the type of result and derivative vectors:</p><pre><code class="language-julia hljs">precision(::AbstractMOP)::Type{&lt;:AbstractFloat}=DEFAULT_PRECISION</code></pre><p>We would also like to deterministically query the expected surrogate model types:</p><pre><code class="language-julia hljs">model_type(::AbstractMOP)::Type{&lt;:AbstractMOPSurrogate}=AbstractMOPSurrogate</code></pre><p>Below functions are used to query dimension information.</p><pre><code class="language-julia hljs">dim_objectives(::AbstractMOP)::Int=0            # mandatory
dim_nl_eq_constraints(::AbstractMOP)::Int=0     # optional
dim_nl_ineq_constraints(::AbstractMOP)::Int=0   # optional</code></pre><h2 id="Linear-Constraints"><a class="docs-heading-anchor" href="#Linear-Constraints">Linear Constraints</a><a id="Linear-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-Constraints" title="Permalink"></a></h2><p>An <code>AbstractMOP</code> can have constrained variables. The corresponding functions should return full bound vectors or <code>nothing</code>. For lower bounds, <code>nothing</code> corresponds to <code>-Inf</code>, but we do not necessarily use such vectors in the inner solver. Upper bounds would be <code>Inf</code> in case of <code>nothing</code>.</p><pre><code class="language-julia hljs">lower_var_bounds(::AbstractMOP)::Union{Nothing, Vec}=nothing
upper_var_bounds(::AbstractMOP)::Union{Nothing, Vec}=nothing</code></pre><p>Moreover, problems can have linear equality constraints and linear inequality constraints</p><p class="math-container">\[  E x = c
  \quad
  A x ≤ b\]</p><pre><code class="language-julia hljs">lin_eq_constraints(::AbstractMOP)::Union{Nothing, Tuple{RMat,RVecOrMat}}=nothing
lin_ineq_constraints(::AbstractMOP)::Union{Nothing, Tuple{RMat,RVecOrMat}}=nothing</code></pre><p>From that we can derive dimension getters as well:</p><pre><code class="language-julia hljs"># helper
dim_lin_constraints(dat::Nothing)=0
function dim_lin_constraints((A,b)::Tuple{RMat, RVecOrMat})
    dim = length(b)
    @assert size(A, 2) == dim &quot;Dimension mismatch in linear constraints.&quot;
    return dim
end
# actual functions
dim_lin_eq_constraints(mop::AbstractMOP)=dim_lin_constraints(lin_eq_constraints(mop))
dim_lin_ineq_constraints(mop::AbstractMOP)=dim_lin_constraints(lin_ineq_constraints(mop))</code></pre><h2 id="Evaluation"><a class="docs-heading-anchor" href="#Evaluation">Evaluation</a><a id="Evaluation-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluation" title="Permalink"></a></h2><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>All evaluation and differentiation methods that you see below should always return <code>nothing</code>, <strong>unless</strong> you want to stop early. Then return something else, for example a string.</p></div></div><p>Evaluation of nonlinear objective functions requires the following method:</p><pre><code class="language-julia hljs">function eval_objectives!(y::RVec, mop::M, x::RVec) where {M&lt;:AbstractMOP}
    error(&quot;`eval_objectives!(y, mop, x) not implemented for mop of type $(M).&quot;)
end</code></pre><p>If there are constraints, these have to be defined as well:</p><pre><code class="language-julia hljs">function eval_nl_eq_constraints!(y::RVec, mop::M, x::RVec) where {M&lt;:AbstractMOP}
    error(&quot;`eval_nl_eq_constraints!(y, mop, x) not implemented for mop of type $(M).&quot;)
end
function eval_nl_ineq_constraints!(y::RVec, mop::M, x::RVec) where {M&lt;:AbstractMOP}
    error(&quot;`eval_nl_ineq_constraints!(y, mop, x) not implemented for mop of type $(M).&quot;)
end</code></pre><p>To ensure, they only get called if needed, we wrap them and assign shorter names:</p><pre><code class="language-julia hljs">objectives!(y::RVec, mop::AbstractMOP, x::RVec)=eval_objectives!(y, mop, x)
nl_eq_constraints!(y::Nothing, mop::AbstractMOP, x::RVec)=nothing
nl_ineq_constraints!(y::Nothing, mop::AbstractMOP, x::RVec)=nothing
nl_eq_constraints!(y::RVec, mop::AbstractMOP, x::RVec)=eval_nl_eq_constraints!(y, mop, x)
nl_ineq_constraints!(y::RVec, mop::AbstractMOP, x::RVec)=eval_nl_ineq_constraints!(y, mop, x)</code></pre><p>Similar methods can be defined for linear constraints.</p><pre><code class="language-julia hljs">&quot;&quot;&quot;
    lin_cons!(residual_vector, prod_cache, constraint_data, x)

Given a linear constraint `A*x .&lt;= b` or `A*x .== b`, compute the product `A*x` and store
the result in `prod_cache`, and also compute `A*x .- b` and store the result in
`residual_vector`.
`constraint_data` should either be the tuple `(A,b)::Tuple{RMat,RVec}` or `nothing`.
&quot;&quot;&quot;
lin_cons!(residual_vector, prod_cache, constraint_data, x)=nothing
lin_cons!(res::Nothing, mat_vec::Nothing, cons::Nothing, x::RVec) = nothing
function lin_cons!(res::RVec, mat_vec::RVec, (A, b)::Tuple, x::RVec)
    LA.mul!(mat_vec, A, x)
    @. res = mat_vec - b
    return nothing
end</code></pre><p>More specific methods with descriptive names applicable to an <code>AbstractMOP</code>:</p><pre><code class="language-julia hljs">lin_eq_constraints!(res::Nothing, mat_vec::Nothing, mop::AbstractMOP, x::RVec)=nothing
lin_ineq_constraints!(res::Nothing, mat_vec::Nothing, mop::AbstractMOP, x::RVec)=nothing
lin_eq_constraints!(res::RVec, mat_vec::Nothing, mop::AbstractMOP, x::RVec)=lin_cons!(res, mat_vec, lin_eq_constraints(mop), x)
lin_ineq_constraints!(res::RVec, mat_vec::Nothing, mop::AbstractMOP, x::RVec)=lin_cons!(res, mat_vec, lin_ineq_constraints(mop), x)</code></pre><h2 id="Pre-Allocation"><a class="docs-heading-anchor" href="#Pre-Allocation">Pre-Allocation</a><a id="Pre-Allocation-1"></a><a class="docs-heading-anchor-permalink" href="#Pre-Allocation" title="Permalink"></a></h2><p>Why do we also allow <code>nothing</code> as the target for constraints? Because that is the default cache returned if there are none:</p><pre><code class="language-julia hljs">function prealloc_objectives_vector(mop::AbstractMOP)
    T = precision(mop)
    return Vector{T}(undef, dim_objectives(mop))
end
# hx = nonlinear equality constraints at x
# gx = nonlinear inequality constraints at x
# Ex = linear equality constraints at x
# Ax = linear inequality constraints at x
# These are defined below (and I put un-specific definitions here for the Linter)
function prealloc_nl_eq_constraints_vector(mop) end
function prealloc_nl_ineq_constraints_vector(mop) end
function prealloc_lin_eq_constraints_vector(mop) end
function prealloc_lin_ineq_constraints_vector(mop) end
for (dim_func, prealloc_func) in (
    (:dim_nl_eq_constraints, :prealloc_nl_eq_constraints_vector),
    (:dim_nl_ineq_constraints, :prealloc_nl_ineq_constraints_vector),
    (:dim_lin_eq_constraints, :prealloc_lin_eq_constraints_vector),
    (:dim_lin_ineq_constraints, :prealloc_lin_ineq_constraints_vector),
)
    @eval function $(prealloc_func)(mop::AbstractMOP)
        dim = $(dim_func)(mop)
        if dim &gt; 0
            T = precision(mop)
            return Vector{T}(undef, dim)
        else
            return nothing
        end
    end
end</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../CompromiseEvaluators/">« Module <code>CompromiseEvaluators</code></a><a class="docs-footer-nextpage" href="../models/">AbstractMOPSurrogate Interface »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Friday 9 February 2024 16:15">Friday 9 February 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
