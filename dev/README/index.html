<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>README · Compromise.jl</title><meta name="title" content="README · Compromise.jl"/><meta property="og:title" content="README · Compromise.jl"/><meta property="twitter:title" content="README · Compromise.jl"/><meta name="description" content="Documentation for Compromise.jl."/><meta property="og:description" content="Documentation for Compromise.jl."/><meta property="twitter:description" content="Documentation for Compromise.jl."/><meta property="og:url" content="https://manuelbb-upb.github.io/Compromise.jl/README/"/><meta property="twitter:url" content="https://manuelbb-upb.github.io/Compromise.jl/README/"/><link rel="canonical" href="https://manuelbb-upb.github.io/Compromise.jl/README/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Compromise.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href>README</a><ul class="internal"><li><a class="tocitem" href="#About-“CoMPrOMISE”"><span>About “CoMPrOMISE”</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li><li><a class="tocitem" href="../stopping/">Stopping Criteria</a></li></ul></li><li><a class="tocitem" href="../dev_notes/">(Dev) Notes</a></li><li><span class="tocitem">Interfaces</span><ul><li><a class="tocitem" href="../CompromiseEvaluators/">Module <code>CompromiseEvaluators</code></a></li><li><a class="tocitem" href="../mop/">AbstractMOP Interface</a></li><li><a class="tocitem" href="../models/">AbstractMOPSurrogate Interface</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>README</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>README</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/manuelbb-upb/Compromise.jl/blob/main/docs/literate_src/README.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Compromise.jl"><a class="docs-heading-anchor" href="#Compromise.jl">Compromise.jl</a><a id="Compromise.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Compromise.jl" title="Permalink"></a></h1><p><a href="https://manuelbb-upb.github.io/Compromise.jl/stable/"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="Stable"/></a> <a href="https://manuelbb-upb.github.io/Compromise.jl/dev/"><img src="https://img.shields.io/badge/docs-dev-blue.svg" alt="Dev"/></a> <a href="https://github.com/manuelbb-upb/Compromise.jl/actions/workflows/CI.yml?query=branch%3Amain"><img src="https://github.com/manuelbb-upb/Compromise.jl/actions/workflows/CI.yml/badge.svg?branch=main" alt="Build Status"/></a> <a href="https://codecov.io/gh/manuelbb-upb/Compromise.jl"><img src="https://codecov.io/gh/manuelbb-upb/Compromise.jl/branch/main/graph/badge.svg" alt="Coverage"/></a></p><h2 id="About-“CoMPrOMISE”"><a class="docs-heading-anchor" href="#About-“CoMPrOMISE”">About “CoMPrOMISE”</a><a id="About-“CoMPrOMISE”-1"></a><a class="docs-heading-anchor-permalink" href="#About-“CoMPrOMISE”" title="Permalink"></a></h2><p><strong>Co</strong>nstrained <strong>M</strong>ultiobjective <strong>Pr</strong>oblem <strong>O</strong>ptimizer with <strong>M</strong>odel <strong>I</strong>nformation to <strong>S</strong>ave <strong>E</strong>valuations</p><p>This package provides a flexible first-order solver for constrained and unconstrained nonlinear multi-objective problems. It uses a trust region approach and either exact derivatives or local surrogate models for a derivative-free descent. Box constraints are respected during model construction and treated as unrelaxable. Box constraints and linear constraints are supported and passed down to an inner LP solver. Nonlinear constraint functions can be modelled and are dealt with by incorporating a filter. They are <em>relaxable</em>, i.e., all other functions must be computable even when the constraints are violated.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><h3 id="Constrained-Two-Parabolas-Problem"><a class="docs-heading-anchor" href="#Constrained-Two-Parabolas-Problem">Constrained Two-Parabolas Problem</a><a id="Constrained-Two-Parabolas-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Constrained-Two-Parabolas-Problem" title="Permalink"></a></h3><p>First we load the optimizer package, “Compromise.jl”:</p><pre><code class="language-julia hljs">using Compromise</code></pre><p>The package exports a simple problem structure, <code>MutableMOP</code>. As the name suggests, this is a mutable structure to define a multi-objective optimization problem. We can use it to set up a problem step by step. The only information required for initialization is the number of variables:</p><pre><code class="language-julia hljs">mop = MutableMOP(;num_vars = 2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MutableMOP
  objectives: Nothing nothing
  nl_eq_constraints: Nothing nothing
  nl_ineq_constraints: Nothing nothing
  num_vars: Int64 2
  dim_objectives: Int64 0
  dim_nl_eq_constraints: Int64 0
  dim_nl_ineq_constraints: Int64 0
  mcfg_objectives: ExactModelConfig ExactModelConfig()
  mcfg_nl_eq_constraints: ExactModelConfig ExactModelConfig()
  mcfg_nl_ineq_constraints: ExactModelConfig ExactModelConfig()
  lb: Nothing nothing
  ub: Nothing nothing
  E: Nothing nothing
  c: Nothing nothing
  A: Nothing nothing
  b: Nothing nothing
</code></pre><p>For a <code>MutableMOP</code>, all functions are vector-to-vector. We can define the objectives (<code>objectives</code>), nonlinear inequality constraints (<code>nl_ineq_constraints</code>) and nonlinear equality constraints (<code>nl_eq_constraints</code>). By default, these fields default to <code>nothing</code>. Alternatively, they need objects of type <code>Compromise.NonlinearFunction</code>. We have helpers to support normal julia functions. For example, consider this vector-to-vector function:</p><pre><code class="language-julia hljs">function objective_function(x)
    return [
        (x[1] - 2)^2 + (x[2] - 1)^2;
        (x[1] - 2)^2 + (x[2] + 1)^2
    ]
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">objective_function (generic function with 1 method)</code></pre><p>We can easily derive the gradients, so let&#39;s also define them manually, to use derivative-based models:</p><pre><code class="language-julia hljs">function objective_grads(x)
    # return the transposed Jacobian, i.e., gradients as columns
    df11 = df21 = 2 * (x[1] - 2)
    df12 = 2 * (x[2] - 1)
    df22 = 2 * (x[2] + 1)
    return [ df11 df21; df12 df22 ]
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">objective_grads (generic function with 1 method)</code></pre><p>To add these functions to <code>mop</code>, we call the helper method <code>add_objectives</code> and also specify the model class to be used. There are shorthand symbols, for example <code>:exact</code> or <code>taylor1</code>, for objectives with known gradients. Alternatively, give some <code>Compromise.A_bstractSurrogateModelConfig</code>. We also have to tell the optimizer about the function signature. <code>func_iip=true</code> would imply an in-place objective with sigunature <code>objective_function!(fx, x)</code>. <code>dim_out</code> is a mandatory argument.</p><pre><code class="language-julia hljs">add_objectives!(
    mop, objective_function, objective_grads, :taylor1;
    dim_out=2, func_iip=false, grads_iip=false
)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>For the above objective function, it would be sensible to additionally have a function <code>objective_values_and_grads</code>, that returns the objectives and gradients at the same time. That is possible, <code>MutableMOP</code> has an interface for such optimizations.</p></div></div><p>We support non-convex, nonlinear constraints (as long as they are relaxable). For example, we can constrain the problem to ℝ² without unit ball. For demonstration purposes, use an in-place function:</p><pre><code class="language-julia hljs">nl_ineq_function!(y, x) = y[1] = 1 - sum(x.^2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">nl_ineq_function! (generic function with 1 method)</code></pre><p>Of course, that is a fairly simple constraint function. If it was more complicated, we could be tempted to use automatic differentiation for derivative calculations. Instead, you can also use derivative-free models, such as radial basis function (RBF) models.</p><h3 id="Excursion:-RBF-Kernels"><a class="docs-heading-anchor" href="#Excursion:-RBF-Kernels">Excursion: RBF Kernels</a><a id="Excursion:-RBF-Kernels-1"></a><a class="docs-heading-anchor-permalink" href="#Excursion:-RBF-Kernels" title="Permalink"></a></h3><p>By default, a cubic kernel is used, if we use the <code>:rbf</code> option with <code>add_nl_ineq_constraints!</code>. To use the Gaussian kernel <span>$φ_ε(r) = \\exp(-(εr)^2)$</span> with fixed shape paramater <code>10</code>, do</p><pre><code class="language-julia hljs">rbf_config = RBFConfig(; kernel=GaussianKernel(10))</code></pre><p>There is other cool features. If you want to vary the shape parameter with the trust-region radius, you can give a function <span>$Δ ↦ ε(Δ)$</span> to <code>GaussianKernel</code> (as well as <code>InverseMultiQuadricKernel</code>).</p><pre><code class="language-julia hljs">gk = GaussianKernel(del -&gt; min(1/del, 1_000))
Compromise.RBFModels.shape_paramater(gk, 1) # equals 1.0
Compromise.RBFModels.shape_paramater(gk, 0.0005) ## equals 1000</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1000.0</code></pre><p>For now, we stick with the fixed shape parameter and finalize our problem:</p><pre><code class="language-julia hljs">add_nl_ineq_constraints!(mop, nl_ineq_function!, :rbf;
    func_iip=true, dim_out=1
)</code></pre><p>The <code>MutableMOP</code> is turned into a <code>TypedMOP</code> during initialization. We can thus simply pass it to <code>optimize</code>:</p><pre><code class="language-julia hljs">final_vals, ret = optimize(mop, [-2.0, 0.5])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Compromise.ValueArrays{Vector{Float64}, Vector{Float64}, Nothing, Vector{Float64}, Nothing, Nothing, Base.RefValue{Float64}, Base.RefValue{Float64}}([0.005222627444685571, 1.0000136426223032], [0.005222627444685571, 1.0000136426223032], [3.979136766244805, 7.979191336734017], nothing, [-5.4561268153507925e-5], nothing, nothing, nothing, nothing, Base.RefValue{Float64}(0.0), Base.RefValue{Float64}(7.979191336734017)), Compromise.CritAbsTolStopping{Float64}
  crit_tol: Float64 2.220446049250313e-16
  theta_tol: Float64 2.220446049250313e-16
)</code></pre><p><code>ret</code> is the return code. If no budget or time based stopping criterion was used, then <code>CRITICAL</code> is a nice return value, indicating a first-order critical point.</p><p><code>final_vals</code> is a <code>ValueArrays</code> object holding values at the final iteration site. <code>final_vals.x</code> is the parameter vector, <code>final_vals.fx</code> has the objective values. The nonlinear equality constraints are <code>final_vals.hx</code>, the inequality constraints are <code>final_vals.gx</code>...</p><pre><code class="language-julia hljs">final_vals.x, final_vals.fx</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([0.005222627444685571, 1.0000136426223032], [3.979136766244805, 7.979191336734017])</code></pre><h3 id="Automatic-Diffentiation"><a class="docs-heading-anchor" href="#Automatic-Diffentiation">Automatic Diffentiation</a><a id="Automatic-Diffentiation-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Diffentiation" title="Permalink"></a></h3><p>There is an optional <code>ForwardDiff</code> extension. To use a derivative-based model without specifying the gradients by-hand, first load <code>ForwardDiff</code>.</p><pre><code class="language-julia hljs">using ForwardDiff</code></pre><p>Now, <code>ForwardDiffBackend</code> should be available:</p><pre><code class="language-julia hljs">diff_backend = ForwardDiffBackend()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ForwardDiffBackendExt.ForwardDiffBackend()</code></pre><p>Set up the problem:</p><pre><code class="language-julia hljs">mop = MutableMOP(2)
add_objectives!(mop, objective_function, :exact;
    func_iip=false, dim_out=2, backend=diff_backend
)

optimize(mop, -5 .+ 10 .* rand(2))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Compromise.ValueArrays{Vector{Float64}, Vector{Float64}, Nothing, Nothing, Nothing, Nothing, Base.RefValue{Float64}, Base.RefValue{Float64}}([1.9999945629815628, 0.7943203263119543], [1.9999945629815628, 0.7943203263119543], [0.04230412819798215, 3.219585433445799], nothing, nothing, nothing, nothing, nothing, nothing, Base.RefValue{Float64}(0.0), Base.RefValue{Float64}(3.219585433445799)), Compromise.MaxCritLoopsStopping(1))</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../stopping/">Stopping Criteria »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 7 February 2024 13:11">Wednesday 7 February 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
